// struct buf：磁盘块缓冲区结构体
// 用于在内存中缓存磁盘块，减少磁盘I/O操作
struct buf {

  // 有效标志：1表示缓冲区中的数据有效（已从磁盘读取）
  // 0表示缓冲区数据无效或脏（需要从磁盘读取或写入磁盘）
  int valid;   // has data been read from disk?

  // 磁盘拥有标志：1表示磁盘正在操作此缓冲区（如读/写进行中）
  // 0表示磁盘未在使用此缓冲区，驱动程序可以使用它
  // 在virtio_disk_rw中会设为1，中断处理后设为0
  int disk;    // does disk "own" buf?

  // 设备号：标识哪个磁盘设备（当系统有多个磁盘时使用）
  // 在xv6中通常为0或1，表示第一个或第二个磁盘
  uint dev;

  // 块号：缓冲区对应的磁盘块号
  // 用于定位数据在磁盘上的位置
  uint blockno;

  // 睡眠锁：保护缓冲区内容的锁
  // 与自旋锁不同，睡眠锁在等待时可让出CPU
  // 用于同步对缓冲区数据的访问
  struct sleeplock lock;

  // 引用计数：当前有多少进程/线程正在使用此缓冲区
  // 用于实现缓冲区的引用计数垃圾回收
  // 当refcnt为0时，缓冲区可被重新用于缓存其他块
  uint refcnt;

  // LRU缓存链表的前驱指针
  // LRU（最近最少使用）算法用于管理缓冲区缓存
  // 当需要淘汰缓冲区时，选择最近最少使用的
  struct buf *prev; // LRU cache list
  
  // LRU缓存链表的后继指针
  struct buf *next;
  
  // 实际数据缓冲区：大小为BSIZE（通常1024字节）
  // 存储磁盘块的内容，是文件系统操作的实际数据区域
  // 一个块有1024个字节，对应1024大小的char数组
  uchar data[BSIZE];
};

